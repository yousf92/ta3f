<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>غرفة الدردشة لا أبرح حتى أبلغ بواسطة يوسف الكردي</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
    <link rel="stylesheet" href="chat.style.css">
</head>
<body>
    <div id="app-lock-overlay">
        <div class="lock-container">
            <i class="bi bi-shield-lock-fill icon"></i>
            <h5>التطبيق مقفل</h5>
            <p class="text-secondary small">أدخل رمز المرور للمتابعة</p>
            <input type="password" inputmode="numeric" pattern="[0-9]*" maxlength="4" class="form-control" id="passcode-input" placeholder="----">
            <div id="passcode-error">رمز المرور غير صحيح</div>
            <button id="unlock-btn" class="btn btn-primary mt-2">فتح القفل</button>
        </div>
    </div>

    <div class="chat-wrapper">
        <div class="chat-container">

            <!-- START: Main View (Tabs) -->
            <div id="main-view" class="chat-view active">
                <div class="d-flex align-items-center p-1 px-2 border-bottom" style="border-color: var(--border-color) !important;">
                    <div class="flex-grow-1">
                        <ul class="nav nav-pills nav-fill">
                            <li class="nav-item">
                                <a class="nav-link active" data-bs-toggle="pill" href="#group-chat-tab">الدردشة الجماعية</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link position-relative" data-bs-toggle="pill" href="#users-list-tab" id="users-tab-link">
                                    المستخدمون
                                    <span id="private-chat-notification-badge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="display: none;">
                                    </span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="pill" href="#groups-tab">المجموعات</a>
                            </li>
                        </ul>
                    </div>
                    <a href="./main.html" class="btn text-white fs-4 ms-2"><i class="bi bi-arrow-right"></i></a>
                </div>
                <div class="tab-content flex-grow-1">
                    <div class="tab-pane fade show active h-100" id="group-chat-tab" style="display: flex; flex-direction: column;">
                         <!-- Group chat content is built by JS -->
                    </div>
                    <div class="tab-pane fade h-100" id="users-list-tab">
                         <!-- User list content is built by JS -->
                    </div>
                    <div class="tab-pane fade h-100" id="groups-tab">
                         <!-- Groups tab content is built by JS -->
                    </div>
                </div>
            </div>
            <!-- END: Main View (Tabs) -->

            <!-- START: Private Chat View -->
            <div id="private-chat-view" class="chat-view">
                <div id="private-chat-header">
                     <button id="back-to-main-view" class="btn text-white fs-4"><i class="bi bi-arrow-right"></i></button>
                     <img id="recipient-avatar" src="https://ssl.gstatic.com/images/branding/product/1x/avatar_circle_blue_512dp.png" alt="Avatar">
                    <div class="flex-grow-1">
                        <h5 id="recipient-name">...</h5>
                    </div>
                    <div class="dropdown">
                        <button class="btn text-white fs-5" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-three-dots-vertical"></i>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end">
                            <li><a class="dropdown-item" href="#" id="block-unblock-btn"></a></li>
                        </ul>
                    </div>
                </div>
                 <div class="main-content">
                    <div id="private-swipe-reply-icon" class="swipe-reply-icon-class"><i class="bi bi-reply-fill"></i></div>
                    <div id="private-messages-box" class="flex-grow-1"></div>
                 </div>
                <div id="private-chat-footer">
                     <div id="private-reply-preview" class="reply-preview">
                        <div id="cancel-private-reply" style="position: absolute; top: 5px; right: 10px; cursor: pointer; font-size: 1.5rem; line-height: 1;">&times;</div>
                        <div class="reply-preview-sender" id="private-reply-preview-sender"></div>
                        <div id="private-reply-preview-text" class="reply-preview-text"></div>
                    </div>
                     <div id="block-notification" class="text-center p-3" style="display: none; background-color: #2a3942; color: var(--secondary-text-color);">
                     </div>
                     <div class="card-footer p-3" id="private-input-area">
                        <div class="input-group-wrapper">
                            <div class="input-group">
                                <textarea id="private-message-input" class="form-control" placeholder="اكتب رسالتك..." rows="1"></textarea>
                                <button id="private-mic-button" class="mic-button"><i class="bi bi-mic-fill"></i></button>
                                <button id="private-send-button" class="btn"><i class="bi bi-send-fill"></i></button>
                            </div>
                        </div>
                        <!-- START: Locked Recording UI -->
                        <div id="private-locked-recording-ui" class="recording-ui" style="display: none; justify-content: space-between; width: 100%;">
                            <button id="private-cancel-recording-btn" class="btn btn-lg text-danger"><i class="bi bi-trash-fill"></i></button>
                            <div class="d-flex align-items: center gap-2">
                                <span class="recording-dot"></span>
                                <span id="private-locked-recording-timer">00:00</span>
                            </div>
                            <button id="private-send-recording-btn" class="mic-button"><i class="bi bi-send-fill"></i></button>
                        </div>
                        <!-- END: Locked Recording UI -->
                        <div id="private-recording-ui" class="recording-ui" style="display: none;">
                            <span class="recording-dot"></span>
                            <span id="private-recording-timer">00:00</span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- END: Private Chat View -->
            
            <!-- START: Group Chat View -->
            <div id="group-chat-view" class="chat-view">
                <div id="group-chat-header">
                     <button id="back-to-main-from-group" class="btn text-white fs-4"><i class="bi bi-arrow-right"></i></button>
                     <div id="group-chat-header-clickable">
                        <img id="group-avatar-header" src="" alt="Group Avatar">
                        <div class="flex-grow-1">
                            <h5 id="group-chat-name">...</h5>
                        </div>
                     </div>
                     <div id="upload-group-photo-container" style="display: none;">
                        <button id="upload-group-photo" class="btn btn-sm" title="تغيير صورة المجموعة"><i class="bi bi-camera-fill"></i></button>
                        <button id="delete-group-photo" class="btn btn-sm" title="حذف صورة المجموعة"><i class="bi bi-trash-fill"></i></button>
                     </div>
                </div>
                 <div id="group-pinned-message-container">
                    <i id="group-unpin-button" class="bi bi-x-circle-fill"></i>
                    <div id="group-pinned-message-clickable-area">
                        <span id="group-pinned-by-text"></span>
                        <span id="group-pinned-message-text"></span>
                    </div>
                </div>
                 <div class="main-content">
                     <div id="group-swipe-reply-icon" class="swipe-reply-icon-class"><i class="bi bi-reply-fill"></i></div>
                     <div id="join-requests-container">
                        <!-- Join requests will be populated here -->
                     </div>
                    <div id="group-messages-box" class="flex-grow-1"></div>
                 </div>
                <div id="group-chat-footer">
                     <div id="group-reply-preview" class="reply-preview">
                        <div id="cancel-group-reply" style="position: absolute; top: 5px; right: 10px; cursor: pointer; font-size: 1.5rem; line-height: 1;">&times;</div>
                        <div class="reply-preview-sender" id="group-reply-preview-sender"></div>
                        <div id="group-reply-preview-text" class="reply-preview-text"></div>
                    </div>
                     <div class="card-footer p-3">
                        <div class="input-group-wrapper">
                            <div class="input-group">
                                <textarea id="group-message-input" class="form-control" placeholder="اكتب رسالتك في المجموعة..." rows="1"></textarea>
                                <button id="group-mic-button" class="mic-button"><i class="bi bi-mic-fill"></i></button>
                                <button id="group-send-button" class="btn"><i class="bi bi-send-fill"></i></button>
                            </div>
                        </div>
                        <!-- START: Locked Recording UI -->
                        <div id="group-locked-recording-ui" class="recording-ui" style="display: none; justify-content: space-between; width: 100%;">
                            <button id="group-cancel-recording-btn" class="btn btn-lg text-danger"><i class="bi bi-trash-fill"></i></button>
                            <div class="d-flex align-items: center gap-2">
                                <span class="recording-dot"></span>
                                <span id="group-locked-recording-timer">00:00</span>
                            </div>
                            <button id="group-send-recording-btn" class="mic-button"><i class="bi bi-send-fill"></i></button>
                        </div>
                        <!-- END: Locked Recording UI -->
                        <div id="group-recording-ui" class="recording-ui" style="display: none;">
                            <span class="recording-dot"></span>
                            <span id="group-recording-timer">00:00</span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- END: Group Chat View -->
            
            <!-- START: Scroll to Bottom Button -->
            <a id="scroll-to-bottom-btn" class="scroll-to-bottom-btn">
                <i class="bi bi-chevron-down"></i>
            </a>
            <!-- END: Scroll to Bottom Button -->
            
        </div>
    </div>
    
    <!-- START: Create Group Modal -->
    <div class="modal fade" id="create-group-modal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title">إنشاء مجموعة جديدة</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="create-group-form">
                        <div class="mb-3">
                            <label for="group-name-input" class="form-label">اسم المجموعة</label>
                            <input type="text" class="form-control" id="group-name-input" required>
                        </div>
                        <div class="mb-3">
                            <label for="group-description-input" class="form-label">وصف قصير</label>
                            <input type="text" class="form-control" id="group-description-input">
                        </div>
                        <button type="submit" class="btn btn-primary w-100">إنشاء</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- END: Create Group Modal -->

    <!-- START: Group Members Modal -->
    <div class="modal fade" id="group-members-modal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title">أعضاء المجموعة</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0" id="group-members-list">
                    <!-- Members will be populated here by JS -->
                </div>
                <div class="modal-footer border-secondary flex-column" id="group-members-modal-footer">
                    <!-- Footer content will be injected here by JS -->
                </div>
            </div>
        </div>
    </div>
    <!-- END: Group Members Modal -->

    <!-- START: Edit Group Description Modal -->
    <div class="modal fade" id="edit-group-description-modal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title">تعديل وصف المجموعة</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="edit-group-description-form">
                        <div class="mb-3">
                            <textarea class="form-control" id="group-description-textarea" rows="4"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">حفظ التغييرات</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- END: Edit Group Description Modal -->

    <!-- START: Edit Message Modal -->
    <div class="edit-modal-backdrop" id="edit-message-modal">
        <div class="edit-modal-content">
            <h6>قم بتعديل رسالتك:</h6>
            <textarea id="edit-message-textarea"></textarea>
            <div class="edit-modal-buttons">
                <button id="cancel-edit-btn" class="btn btn-secondary">إلغاء</button>
                <button id="save-edit-btn" class="btn btn-primary">حفظ</button>
            </div>
        </div>
    </div>
    <!-- END: Edit Message Modal -->
    
    <!-- START: Custom Confirm Modal HTML -->
    <div class="confirm-modal-backdrop" id="custom-confirm-modal">
        <div class="confirm-modal-content">
            <div class="confirm-modal-icon"><i class="bi bi-exclamation-triangle-fill"></i></div>
            <p class="confirm-modal-message" id="custom-confirm-message"></p>
            <div class="confirm-modal-buttons">
                <button class="confirm-modal-btn btn-confirm-secondary" id="custom-confirm-cancel">إلغاء</button>
                <button class="confirm-modal-btn btn-confirm-danger" id="custom-confirm-ok">تأكيد</button>
            </div>
        </div>
    </div>
    <!-- END: Custom Confirm Modal HTML -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script src="chat.setup.js"></script>
    <script src="chat.script.js" type="module"></script>
    
    <!-- Loading Spinner -->
    <div id="loading-spinner-overlay" class="loading-spinner-overlay">
        <div class="loading-spinner"></div>
    </div>
    <!-- End Loading Spinner -->

</body>
</html>
