<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>المتابعة | لا أبرح حتى أبلغ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="follow.style.css">
</head>
<body>
    <div id="app-lock-overlay">
        <div class="lock-container">
            <i class="bi bi-shield-lock-fill icon"></i>
            <h5>التطبيق مقفل</h5>
            <p class="text-secondary small">أدخل رمز المرور للمتابعة</p>
            <input type="password" inputmode="numeric" pattern="[0-9]*" maxlength="4" class="form-control" id="passcode-input" placeholder="----">
            <div id="passcode-error">رمز المرور غير صحيح</div>
            <button id="unlock-btn" class="btn btn-primary mt-2">فتح القفل</button>
        </div>
    </div>

    <div class="page" style="display: flex;">
        <header class="top-header">
            <h5 class="m-0">المتابعة</h5>
        </header>
        <main class="content-area">
            
            <div class="calendar-container">
                <div class="stats-grid">
                    <div class="stat-card orange">
                        <i class="bi bi-calendar-x stat-icon"></i>
                        <div id="absence-count" class="stat-number">0</div>
                        <div class="stat-label">غياب</div>
                    </div>
                    <div class="stat-card grey">
                        <i class="bi bi-arrow-down-circle stat-icon"></i>
                        <div id="relapse-count" class="stat-number">0</div>
                        <div class="stat-label">انتكاسة</div>
                    </div>
                    <div class="stat-card red">
                        <i class="bi bi-exclamation-triangle stat-icon"></i>
                        <div id="slip-count" class="stat-number">0</div>
                        <div class="stat-label">زلة</div>
                    </div>
                    <div class="stat-card green">
                        <i class="bi bi-check-circle-fill stat-icon"></i>
                        <div id="victory-count" class="stat-number">0</div>
                        <div class="stat-label">انتصار</div>
                    </div>
                </div>

                <div class="calendar-card">
                    <div class="calendar-header">
                        <button id="prev-month"><i class="bi bi-chevron-right"></i></button>
                        <div id="month-year"></div>
                        <button id="next-month"><i class="bi bi-chevron-left"></i></button>
                    </div>
                    <div class="calendar-grid" id="weekdays"></div>
                    <div class="calendar-grid" id="calendar-days"></div>
                </div>
            </div>
            
            <div id="contextual-gemini-card" class="card mt-4 d-none" style="background-color: var(--card-background); border-radius: 15px; border: 1px solid var(--primary-color); box-shadow: 0 0 15px var(--primary-glow);">
                <div class="card-body text-center">
                    <h6 id="contextual-gemini-title" class="mb-3 fw-bold"></h6>
                    <button id="contextual-gemini-btn" class="btn btn-warning w-100 fw-bold"></button>
                    <div id="contextual-gemini-result-container" class="mt-3 p-3 rounded d-none" style="background-color: var(--background-color);">
                        <p id="contextual-gemini-result-text" class="mb-0" style="white-space: pre-wrap;"></p>
                    </div>
                </div>
            </div>

            <div id="analysis-frame" class="gemini-frame mt-4">
                 <div class="analysis-options mb-3">
                     <label class="form-label small fw-bold">اختر أسلوب التحليل</label>
                     <div id="analysis-style-group" class="analysis-toggle-group">
                        <button class="analysis-toggle-btn active" data-style="advisor">
                            <i class="bi bi-shield-heart me-2"></i><span>ناصح أمين</span>
                        </button>
                        <button class="analysis-toggle-btn" data-style="leader">
                            <i class="bi bi-award me-2"></i><span>قائد ملهم</span>
                        </button>
                    </div>
                 </div>
                 <button id="analyze-performance-btn" class="btn btn-info w-100 fw-bold">
                      <i class="bi bi-magic me-2"></i>حلل أدائي
                 </button>
                 <div id="analysis-result-container" class="result-container mt-3 p-3 rounded d-none">
                      <p id="analysis-result-text" class="result-text mb-0" style="white-space: pre-wrap;"></p>
                 </div>
            </div>

        </main>

        <button class="add-status-button" data-bs-toggle="modal" data-bs-target="#addStatusModal" title="إضافة حالة اليوم">
            <i class="bi bi-plus-lg"></i>
        </button>

        <nav class="bottom-nav">
            <a href="main.html" class="nav-item"><i class="bi bi-house-door-fill"></i><span>الرئيسية</span></a>
            <a href="diaries.html" class="nav-item"><i class="bi bi-book-fill"></i><span>اليوميات</span></a>
            <a href="articles.html" class="nav-item"><i class="bi bi-check2-square"></i><span>العادات</span></a>
            <a href="chat.html" class="nav-item special-item">
                <div class="icon-background"><i class="bi bi-chat-dots-fill"></i></div>
                <span>دردشة</span>
                <span class="chat-notification-badge"></span>
            </a>
            <a href="follow-up.html" class="nav-item active"><i class="bi bi-signpost-split-fill"></i><span>المتابعة</span></a>
            <a href="library.html" class="nav-item"><i class="bi bi-collection-fill"></i><span>المكتبة</span></a>
            <a href="settings.html" class="nav-item"><i class="bi bi-gear-fill"></i><span>الاعدادات</span></a>
        </nav>
    </div>

    <div class="modal fade" id="addStatusModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background-color: var(--card-background);">
                <div class="modal-header" style="border-bottom-color: var(--border-color);">
                    <h5 class="modal-title">كيف كان يومك؟</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" style="filter: invert(1)"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted">اختر الحالة التي تريد تسجيلها لتاريخ اليوم.</p>
                    <div class="d-grid gap-3">
                        <button class="btn btn-lg" style="background-color: var(--grey-color); color: white;" data-status="relapse">انتكاسة</button>
                        <button class="btn btn-lg" style="background-color: var(--red-color); color: white;" data-status="slip">زلة</button>
                        <button class="btn btn-lg" style="background-color: var(--green-color); color: white;" data-status="victory">انتصار</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="follow.script.js" type="module"></script>
</body>
</html>
